.set LOCALID_PROSPECTOR, 1

ThreeIsland_DunsparceTunnel_MapScripts::
	map_script MAP_SCRIPT_ON_TRANSITION, ThreeIsland_DunsparceTunnel_OnTransition
	.byte 0

ThreeIsland_DunsparceTunnel_OnTransition::
	setworldmapflag FLAG_WORLD_MAP_THREE_ISLAND_DUNSPARCE_TUNNEL
	call_if_set FLAG_SYS_RECEIVED_EXTENDED_DEX, ThreeIsland_DunsparceTunnel_EventScript_SetLayoutDugOut
	call_if_unset FLAG_SYS_RECEIVED_EXTENDED_DEX, ThreeIsland_DunsparceTunnel_EventScript_MoveProspectorToWall
	end

ThreeIsland_DunsparceTunnel_EventScript_SetLayoutDugOut::
	setmaplayoutindex LAYOUT_THREE_ISLAND_DUNSPARCE_TUNNEL_DUG_OUT
	return

ThreeIsland_DunsparceTunnel_EventScript_MoveProspectorToWall::
	setobjectxyperm LOCALID_PROSPECTOR, 6, 3
	setobjectmovementtype LOCALID_PROSPECTOR, MOVEMENT_TYPE_FACE_RIGHT
	return

ThreeIsland_DunsparceTunnel_EventScript_Prospector::
	lock
	faceplayer
	goto_if_set FLAG_GOT_NUGGET_FROM_DUNSPARCE_TUNNEL, ThreeIsland_DunsparceTunnel_EventScript_ProspectorAlreadyGaveNugget
	goto_if_set FLAG_SYS_RECEIVED_EXTENDED_DEX, ThreeIsland_DunsparceTunnel_EventScript_ProspectorStruckGold
	msgbox ThreeIsland_DunsparceTunnel_Text_ProspectingForGold
	closemessage
	applymovement LOCALID_PROSPECTOR, Common_Movement_FaceOriginalDirection
	waitmovement 0
	release
	end

ThreeIsland_DunsparceTunnel_EventScript_ProspectorStruckGold::
	msgbox ThreeIsland_DunsparceTunnel_Text_StruckGoldThisIsForYou
	goto_if_set FLAG_GOT_DOME_FOSSIL, ThreeIsland_DunsparceTunnel_EventScript_GiveHelixFossil
	bufferitemnameplural 0, ITEM_DOME_FOSSIL, 1
	giveitem_msg ThreeIsland_DunsparceTunnel_Text_ObtainedFossil, ITEM_DOME_FOSSIL, 1, MUS_OBTAIN_KEY_ITEM
	goto_if_eq VAR_RESULT, FALSE, ThreeIsland_DunsparceTunnel_EventScript_NoRoomForNugget
	setflag FLAG_GOT_NUGGET_FROM_DUNSPARCE_TUNNEL
	goto ThreeIsland_DunsparceTunnel_EventScript_ProspectorAlreadyGaveNugget
	end

ThreeIsland_DunsparceTunnel_EventScript_GiveHelixFossil::
	bufferitemnameplural 0, ITEM_HELIX_FOSSIL, 1
	giveitem_msg ThreeIsland_DunsparceTunnel_Text_ObtainedFossil, ITEM_HELIX_FOSSIL, 1, MUS_OBTAIN_KEY_ITEM
	goto_if_eq VAR_RESULT, FALSE, ThreeIsland_DunsparceTunnel_EventScript_NoRoomForNugget
	setflag FLAG_GOT_NUGGET_FROM_DUNSPARCE_TUNNEL
	goto ThreeIsland_DunsparceTunnel_EventScript_ProspectorAlreadyGaveNugget
	end

ThreeIsland_DunsparceTunnel_EventScript_NoRoomForNugget::
	msgbox ThreeIsland_DunsparceTunnel_Text_WhoopsBagCrammedFull
	release
	end

ThreeIsland_DunsparceTunnel_EventScript_ProspectorAlreadyGaveNugget::
	call_if_set FLAG_GOT_DOME_FOSSIL, ThreeIsland_DunsparceTunnel_EventScript_BufferHelix
	call_if_unset FLAG_GOT_DOME_FOSSIL, ThreeIsland_DunsparceTunnel_EventScript_BufferDome
	msgbox ThreeIsland_DunsparceTunnel_Text_ThatsANugget
	release
	end

ThreeIsland_DunsparceTunnel_EventScript_BufferHelix::
	bufferitemnameplural 0, ITEM_HELIX_FOSSIL, 1
	return

ThreeIsland_DunsparceTunnel_EventScript_BufferDome::
	bufferitemnameplural 0, ITEM_DOME_FOSSIL, 1
	return
